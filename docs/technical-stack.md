# 技術スタック

## MVP実装構成

APIをフル活用して、自前でサーバーを持たない構成にします。

## 使用API一覧

| 役割 | 採用するツール/API | 理由 |
|------|-------------------|------|
| データ取得 | Google Search Console API | 信頼できる順位データの取得（キーワードと順位の組み合わせも取得可能） |
| 検索・URL抽出 | ブラウジングツール（Playwright推奨、Puppeteerも可） | GSC APIで取得したキーワードと順位をもとに、Google検索を実行して競合URLを取得。Serper APIのコスト（約1.5円）を削減。Playwrightは複数ブラウザ対応でCAPTCHA回避の可能性が高い |
| 競合記事スクレイピング | 自前クローラー（cheerio推奨） | APIコストを削減。cheerio（Node.js）でHTMLパース、必要に応じてPlaywrightでJavaScriptレンダリング。Node.jsエコシステムと統合しやすい |
| 知能・生成 | Gemini 2.5 Flash | 圧倒的な処理速度と、長文記事（コンテキスト）の読み込み能力 |
| 通知 | Resend（メール推奨）、Slack Webhook、LINE Notify | ユーザーが「わざわざ見に行かなくていい」環境。Resendは無料枠が充実（3,000通/月） |

## 技術詳細

### Frontend
- **Framework**: Next.js (App Router)
- **Styling**: Tailwind CSS
- **目的**: 最小限のダッシュボードUI（MVPでは通知が主）

### Backend
- **Runtime**: Node.js
- **API Routes**: Next.js API Routes
- **実行環境**: Vercel（推奨）
  - Next.jsとの統合が完璧
  - デプロイが簡単（GitHub連携）
  - 無料枠が充実（個人開発には十分）
  - Cron機能が標準搭載
- **認証**: NextAuth.js（OAuth 2.0）
  - Next.jsとの統合が完璧
  - OAuth 2.0の実装が簡単
  - セッション管理が自動

### 定期実行
- **方法**: Vercel Cron（推奨）
  - Vercelとの統合が完璧
  - セットアップが簡単（`vercel.json`に設定を追加するだけ）
  - 無料枠で利用可能
- **頻度**: 毎日（順位チェック）

### データストレージ
- **データベース**: Supabase（推奨）
  - 無料枠が充実（500MB、2プロジェクト）
  - PostgreSQLベース（標準SQL）
  - リアルタイム機能（将来的に必要になった場合に対応可能）
  - 認証機能も提供（NextAuth.jsと組み合わせ可能）
- **保存内容**: 
  - ユーザー設定（GSC連携情報、通知先）
  - 分析履歴（キャッシュ用）
  - 順位データ（前回比較用）

## コスト最適化のためのTips

1. **Gemini 2.5 Flashの採用**
   - ProではなくFlashを使うことで、コストを1/10以下に抑えつつ十分な品質を維持

2. **ブラウジングツールの採用**
   - Serper API（約1.5円）をブラウジングツール（0円）に置き換えることで、コストを削減
   - GSC APIと統合しやすい（キーワードと順位のデータをそのまま活用）

3. **キャッシュの活用**
   - 同じ競合サイトを他ユーザーが分析した際は、スクレイピング結果を再利用（クローラーは自前のため追加コストなし）
   - ブラウジングツールの検索結果もキャッシュ可能

3. **同時実行数の制限**
   - ビジネスプランでも「同時実行数」で制限し、APIの乱用を防ぐ

