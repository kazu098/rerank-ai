# 記事提案機能の動作確認チェックリスト

## 前提条件

### 1. DBマイグレーションの実行
**必須**: Supabaseダッシュボードで以下のマイグレーションを実行する必要があります。

```sql
-- supabase/migrations/013_create_article_suggestions.sql
```

**実行方法**:
1. Supabaseダッシュボードにログイン
2. SQL Editorを開く
3. `013_create_article_suggestions.sql`の内容をコピー＆ペースト
4. 実行

**確認方法**:
```sql
SELECT * FROM article_suggestions LIMIT 1;
```
エラーが出なければOK。

### 2. GSC API連携の確認
- Googleアカウントでログイン済み
- Search Consoleプロパティが選択済み
- GSC APIのトークンが有効（期限切れでない）

### 3. 既存データの確認
- サイトが登録されている（`sites`テーブル）
- 既存記事が登録されている（`articles`テーブル、任意だが推奨）

## 動作確認手順

### Step 1: タブの表示確認
1. ホーム画面（`/`）にアクセス
2. ログイン済みの場合、GSCプロパティを選択
3. 「記事分析」と「新規記事提案」のタブが表示されることを確認
4. 「新規記事提案」タブをクリックして切り替えができることを確認

### Step 2: 提案生成の実行
1. 「新規記事提案」タブを選択
2. 選択中のプロパティが表示されていることを確認
3. 「記事提案を生成」ボタンをクリック
4. 進捗表示（「提案を生成中...」）が表示されることを確認

### Step 3: エラーハンドリングの確認
**想定されるエラーケース**:

1. **DBマイグレーション未実行**
   - エラー: `relation "article_suggestions" does not exist`
   - 対応: マイグレーションを実行

2. **GSC APIトークン期限切れ**
   - エラー: `401 Unauthorized` または `invalid_token`
   - 対応: 再ログインしてトークンをリフレッシュ

3. **サイトにキーワードデータがない**
   - エラー: 提案が0件になる可能性
   - 対応: 正常な動作（データがない場合は提案できない）

4. **既存記事がない場合**
   - エラー: なし（既存記事がなくても動作する）
   - 対応: すべてのキーワードがギャップとして扱われる

### Step 4: 提案一覧の表示確認
1. 提案生成が完了したら、提案一覧が表示されることを確認
2. 各提案に以下が表示されることを確認:
   - タイトル
   - キーワード（最大5個表示）
   - 提案理由
   - 推定インプレッション数
   - ステータス（未着手/作成中/完了/スキップ）

### Step 5: ステータス更新の確認
1. 「作成開始」ボタンをクリック
2. ステータスが「作成中」に変わることを確認
3. 「完了」ボタンをクリック
4. ステータスが「完了」に変わることを確認

## 確認すべきポイント

### パフォーマンス
- 提案生成にかかる時間（小規模サイト: 5-10秒、大規模サイト: 10-30秒）
- ページネーション処理（キーワード数 > 25,000の場合）

### データの整合性
- 提案がDBに正しく保存されているか
- サイトIDとユーザーIDの整合性
- ステータス更新が正しく反映されるか

### UI/UX
- 翻訳が正しく表示されるか（日本語/英語）
- エラーメッセージが適切に表示されるか
- ローディング状態が適切に表示されるか

## トラブルシューティング

### 提案が生成されない
1. ブラウザのコンソールでエラーを確認
2. サーバーログを確認（`console.error`の出力）
3. GSC APIのレスポンスを確認

### 提案が0件になる
- 既存記事でカバーされているキーワードが多い
- ギャップキーワードの条件（インプレッション数 >= 10、順位 > 20）を満たすキーワードがない
- 正常な動作の可能性もある

### ステータス更新が反映されない
1. APIエンドポイント（`/api/article-suggestions/[id]/status`）のレスポンスを確認
2. DBの更新を確認
3. フロントエンドの再読み込み処理を確認

## 次のステップ（フェーズ2）

フェーズ1の動作確認が完了したら、以下を実装:
- LLM統合（Gemini Flash 2.0）で詳細な提案生成
- 既存記事の見出し構造分析
- より高度なタイトル生成

