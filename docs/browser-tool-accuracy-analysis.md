# ブラウジングツールの精度分析

## ブラウジングツール vs Serper API の精度比較

### 1. 競合URL取得の精度

#### Serper API
- **精度**: 非常に高い（99%以上）
- **理由**: Google検索APIを直接使用するため、検索結果が正確
- **制限**: なし（API経由のため）

#### ブラウジングツール
- **精度**: 中程度〜高い（80-95%）
- **理由**: 
  - Google検索のHTMLをパースするため、検索結果の構造変更に影響される
  - CAPTCHAが表示された場合、検索結果を取得できない
  - レート制限でIPブロックされる可能性
- **対策**:
  - 複数のユーザーエージェントをローテーション
  - リクエスト間隔を調整（例：5-10秒間隔）
  - CAPTCHA検出時のリトライ機能
  - フォールバック: Serper APIに切り替え

### 2. 順位特定の精度

#### Serper API
- **精度**: 非常に高い（99%以上）
- **理由**: 検索結果の順位が正確に取得できる

#### ブラウジングツール
- **精度**: 中程度（70-90%）
- **課題**:
  - 検索結果に自社URLが含まれない場合（100位以下）は順位を特定できない
  - 検索結果の個人化（地域、デバイス、検索履歴）により、順位が異なる可能性
  - 検索結果の構造変更に影響される
- **対策**:
  - 複数の検索条件で試行（例：地域、デバイス）
  - 検索結果に自社URLが含まれない場合のエラーハンドリング
  - GSC連携時は、GSC APIから順位を取得（より正確）

### 3. 実装上の考慮事項

#### CAPTCHA対応
- **発生頻度**: 低〜中（リクエスト頻度による）
- **対策**:
  - リクエスト間隔を5-10秒に設定
  - ユーザーエージェントのローテーション
  - CAPTCHA検出時のリトライ（最大3回）
  - 失敗時のフォールバック（Serper API）

#### レート制限
- **発生頻度**: 中（過度なリクエストの場合）
- **対策**:
  - リクエスト間隔の調整
  - IPローテーション（プロキシの使用）
  - キャッシュの活用（同じキーワードの検索結果を再利用）

#### 実行時間
- **Serper API**: 1-2秒
- **ブラウジングツール**: 5-10秒（ブラウザ起動時間含む）
- **影響**: ユーザー体験への影響は限定的（バックグラウンド処理）

## 推奨実装方針

### MVP段階
1. **ブラウジングツールを採用**（コスト削減のため）
2. **精度向上のための対策を実装**:
   - CAPTCHA検出とリトライ機能
   - リクエスト間隔の調整
   - エラーハンドリングの強化
3. **フォールバック機能**:
   - ブラウジングツールが失敗した場合、Serper APIに自動切り替え
   - ユーザーに通知（「検索結果の取得に時間がかかっています」など）

### 精度目標
- **競合URL取得**: 90%以上
- **順位特定**: 80%以上（GSC連携時は95%以上）

### モニタリング
- 成功率の追跡
- 失敗原因の分析（CAPTCHA、レート制限、その他）
- 精度が目標を下回る場合、Serper APIへの切り替えを検討

