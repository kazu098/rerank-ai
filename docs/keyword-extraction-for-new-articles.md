# インプレッションが出ていない記事の分析対応案

## 問題
GSC APIからキーワードデータが取得できない（過去90日間で検索結果に表示されていない）記事でも、分析したいニーズがある。

## 対応案

### 案1: 記事コンテンツからキーワードを自動抽出・提案 ⭐推奨
**概要**: 記事のタイトル、見出し、URLパス、メタデータからキーワードを抽出して提案する

**実装方法**:
1. 記事をスクレイピングして以下を取得：
   - タイトル（`<title>`, `<h1>`, `og:title`）
   - 見出し（`<h2>`, `<h3>`など）
   - メタディスクリプション（`meta[name="description"]`, `og:description`）
   - URLパス（例：`/articles/chatbot-dounyuu-shippai` → "chatbot", "導入", "失敗"）
2. 抽出したテキストから重要キーワードを抽出：
   - 名詞を抽出（形態素解析またはシンプルなルールベース）
   - 見出しに含まれるキーワードを優先
   - URLパスからもキーワードを抽出
3. 抽出したキーワードをユーザーに提案：
   - 「この記事から以下のキーワードが抽出されました。分析に使用するキーワードを選択してください」
   - ユーザーが選択・編集可能

**メリット**:
- コストがかからない（既存のスクレイピング機能を活用）
- 実装が比較的簡単
- 記事の内容に基づいた適切なキーワードを提案できる

**デメリット**:
- 精度は完璧ではない（形態素解析が必要）
- 検索ボリュームがわからない

**実装コスト**: 低〜中

---

### 案2: ユーザーが手動でキーワードを入力 ⭐実装済み
**概要**: キーワードが取得できない場合、ユーザーが手動でキーワードを入力できる

**実装状況**: 既に実装済み（キーワード選択モーダルで手動入力可能）

**改善点**:
- より目立つUIにする
- キーワード入力のガイドを追加（「この記事で狙いたいキーワードを入力してください」など）

---

### 案3: URLパスからキーワードを自動推測
**概要**: URLパスからキーワードを抽出して提案する

**実装方法**:
- URLパスを分割（例：`/ja/store-app/articles/chatbot-dounyuu-shippai`）
- 各パスセグメントからキーワードを抽出
- スラッグを分解（例：`chatbot-dounyuu-shippai` → "chatbot", "導入", "失敗"）

**メリット**:
- 実装が簡単
- コストがかからない

**デメリット**:
- URL構造に依存する
- 精度は限定的

**実装コスト**: 低

---

### 案4: LLMで記事内容からキーワードを抽出
**概要**: LLMを使って記事の内容から関連キーワードを抽出する

**実装方法**:
1. 記事をスクレイピング
2. LLMに「この記事でSEO対策として狙うべきキーワードを5つ提案してください」と依頼
3. 抽出したキーワードをユーザーに提案

**メリット**:
- 精度が高い
- 記事の内容を理解した上でキーワードを提案できる

**デメリット**:
- コストがかかる（LLM API呼び出し）
- 処理時間がかかる

**実装コスト**: 中〜高

---

### 案5: 競合記事のキーワードを参考にする
**概要**: 記事のタイトルや内容が似ている競合記事を探し、そのキーワードを参考にする

**実装方法**:
1. 記事のタイトルや内容から特徴を抽出
2. 検索エンジンで類似記事を検索
3. 類似記事のキーワードを参考に提案

**メリット**:
- 実際に検索されているキーワードを提案できる

**デメリット**:
- 実装が複雑
- 検索APIのコストがかかる可能性

**実装コスト**: 高

---

## 推奨実装順序

1. **案1（記事コンテンツからキーワード抽出）** + **案3（URLパスからキーワード抽出）**
   - コストがかからず、実装も比較的簡単
   - 案2（手動入力）と組み合わせて、ユーザーが選択・編集できるようにする

2. **案2（手動入力）の改善**
   - UIを改善して、より使いやすくする
   - キーワード入力のガイドを追加

3. **案4（LLM抽出）**（オプション）
   - より高精度なキーワード抽出が必要な場合
   - 有料プランの特典として提供する

## 実装の詳細（案1+案3）

### キーワード抽出ロジック
```typescript
// 1. URLパスからキーワードを抽出
function extractKeywordsFromUrl(url: string): string[] {
  const urlObj = new URL(url);
  const pathParts = urlObj.pathname
    .split('/')
    .filter(part => part.length > 1)
    .map(part => part.replace(/-/g, ' ')); // ハイフンをスペースに変換
  
  return pathParts;
}

// 2. タイトルからキーワードを抽出
function extractKeywordsFromTitle(title: string): string[] {
  // シンプルなルールベース（形態素解析なし）
  // または、既存のKeywordPrioritizerのnormalizeKeywordを使用
  const words = title.split(/[\s\-・、。]/).filter(w => w.length > 1);
  return words;
}

// 3. 見出しからキーワードを抽出
function extractKeywordsFromHeadings(headings: string[]): string[] {
  // 見出しに含まれる重要キーワードを抽出
  // 長い見出しから重要な部分を抽出
  return headings.flatMap(h => extractKeywordsFromTitle(h));
}
```

### 統合方法
1. `analyzeStep1`でキーワードが取得できない場合、記事をスクレイピング
2. 抽出したキーワードをユーザーに提案
3. ユーザーが選択・編集して分析を続行

