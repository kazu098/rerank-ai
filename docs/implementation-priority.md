# 実装優先順位

## 最小実装（自社サイトで効果を実感するための最優先実装）

**目的**: 自社サイトの記事で効果を実感する

**前提**: GSC連携は必須（自社サイトの順位データを取得するため）

詳細は [最小実装仕様](./minimum-viable-implementation.md) を参照。

## MVP開発の優先順位（一般向け）

### 最優先: GSC連携と順位下落検知の自動通知（自社サイト用）

**目的**: 自社サイトの順位下落を自動検知し、リライト案を通知

**実装内容**:
1. **ブラウジングツールで競合URLを取得**（Serper APIの代替）
   - GSC APIで取得したキーワードと順位をもとに、Google検索を実行
   - 検索結果から自社URLより上位のサイトURLを抽出
   - **手動スキャン時**: 入力されたキーワードでGoogle検索を実行
2. **ブラウジングツールで現在の順位を特定**（GSC連携不要の場合のみ）
   - 検索結果から自社URLの順位を特定
   - **注意**: GSC連携時は、GSC APIから「どのキーワードでどの順位」というデータを取得可能なので、このステップは省略
3. **自前クローラーで競合記事をスクレイピング**（Beautiful Soup/cheerio等）
   - HTMLパースでテキスト抽出
   - 必要に応じてPlaywright等でJavaScriptレンダリング
4. Gemini 2.5 Flashで差分分析と追加項目提案の生成（箇条書き形式）
5. 結果をMarkdown形式で出力

**成果物**: 
- バックエンドスクリプト（Node.js）
- 1ファイルに凝縮したデモスクリプト

**成功基準**: 
- 入力: 自社記事URL + キーワード（またはAI推測）
- 出力: 現在の順位 + 追加すべき項目の箇条書き
- **GSC連携なしで動作する**
- **コスト**: 約2.5円（ブラウジングツールでSerper APIのコストを削減）

### 優先度2: 「ログイン不要の無料お試し」画面の実装

**目的**: First Wow Experienceを提供する（GSC連携不要）

**実装内容**:
1. ランディングページ（Next.js）
2. **「デモを見る」ボタン**（成功事例を先に見せる）
3. URL入力フォーム（キーワード入力またはAI推測）
4. **現在の順位を表示**（ブラウジングツールで取得）
5. 分析結果の一部表示（見出し1つ分）
6. アカウント作成への誘導

**成果物**: 
- フロントエンド（Next.js + Tailwind CSS）
- API Route（分析実行）
- デモモード（サンプルデータ表示）

**成功基準**: 
- 未ログインでも30秒以内に結果の一部が表示される
- **GSC連携なしで「現在の順位」を表示できる**
- アカウント作成への転換率が高い

### 最優先: GSC連携と順位下落検知の自動通知（自社サイト用）

**目的**: 自社サイトの順位下落を自動検知し、リライト案を通知（GSC連携必須）

**実装内容**:
1. **OAuth 2.0認証の実装**（1クリックでGSC連携）
   - Google Cloud Consoleでアプリ作成
   - 「Googleでログイン」ボタン
   - APIキー発行は不要
2. Google Search Console APIとの連携
   - 特定記事（URL）の時系列データ取得
   - キーワード（クエリ）ごとの順位、CTR、インプレッション取得
3. 順位データの定期取得（Cron）
   - 毎日1回、前日のデータを取得（GSCデータは1-2日遅れで反映）
4. 急落の検知ロジック
   - 過去N日間（例：7日間）の平均順位と現在の平均順位を比較
   - 急落の定義：平均順位が2位以上下落、または特定キーワードが10位以下に転落
   - 「落選」キーワード（10位前後）を特定し、優先的に分析
5. **競合URLの取得（ブラウジングツール）**
   - 下落したキーワードでGoogle検索を実行（Playwright/Puppeteer）
   - 検索結果から自社URLより上位のサイトURLを抽出（上位3サイト）
6. **競合記事のスクレイピング**
   - Beautiful Soup/cheerioでHTMLパース
   - テキスト抽出
7. **差分分析とリライト案生成（Gemini 2.5 Flash）**
   - 自社記事と競合記事を比較
   - 箇条書き形式で追加すべき項目を生成
8. **メール通知の送信**
   - 順位下落の詳細 + 追加すべき項目の箇条書き

**成果物**: 
- OAuth 2.0認証機能（NextAuth.js推奨）
- GSC連携機能
- 順位下落検知ロジック
- ブラウジングツールでの競合URL取得
- 競合記事スクレイピング機能
- 差分分析とリライト案生成機能
- 定期実行スクリプト（Vercel Cron）
- メール送信機能

**成功基準**: 
- **1クリックでGSC連携が完了する**
- 順位が急落した際、24時間以内に通知が届く
- 通知内容が具体的で、アクション可能（箇条書き形式のリライト案）
- **自社サイトで効果を実感できる**

**期間**: 約2週間（10-14日）

### 優先度2: 1記事分析のロジック（手動スキャン用・GSC連携不要）

**目的**: GSC連携不要で、任意のURLを分析できる機能（一般ユーザー向け）

### 優先度4: ダッシュボードUI（最小限）

**目的**: 分析結果の閲覧と履歴管理

**実装内容**:
1. ログイン機能
2. 分析結果の表示画面
3. 分析履歴の一覧
4. 設定画面（通知先、GSC連携）

**成果物**: 
- ダッシュボード（Next.js）
- 認証機能（NextAuth.js推奨）

**成功基準**: 
- 分析結果が分かりやすく表示される
- コピー＆ペーストが簡単にできる

## 実装フェーズ

### Phase 1: 最小実装（自社サイトで効果を実感・GSC連携必須）

- [ ] OAuth 2.0認証の実装（1クリックでGSC連携）
- [ ] GSC API連携（順位データ取得）
- [ ] 順位下落検知ロジック
- [ ] ブラウジングツールでの競合URL取得
- [ ] 競合記事スクレイピング
- [ ] 差分分析とリライト案生成（Gemini 2.5 Flash）
- [ ] メール通知機能
- [ ] 定期実行（Cron）

**期間**: 約2週間（10-14日）

**重要**: 
- **GSC連携は必須**（自社サイトの順位データを取得するため）
- フロントエンドは最小限（通知で完結）
- 自社サイトで効果を実感できることを最優先

詳細は [最小実装仕様](./minimum-viable-implementation.md) を参照。

### Phase 2: 手動スキャン機能（GSC連携不要）

- [ ] 1記事分析のロジック（ブラウジングツール + 自前クローラー + Gemini）
  - ブラウジングツール（Playwright、Puppeteer等）で競合URLを取得
  - ブラウジングツールで現在の順位を特定
  - キーワード入力またはAI推測
  - 自前クローラー（Beautiful Soup/cheerio等）で競合記事スクレイピング
  - CAPTCHA対応（リトライ機能、ユーザーエージェントローテーション等）
- [ ] 無料お試し画面（ログイン不要）
  - URL入力フォーム
  - 現在の順位表示
  - 改善案の一部表示
- [ ] デモモード（成功事例表示）

**期間**: 1-2週間

### Phase 3: 通知の多様化と設定

- [ ] Slack通知
- [ ] LINE通知
- [ ] 通知頻度設定（優先度低）
  - 例：毎日、週1回まとめて、急落時のみなど
- [ ] **アラート設定のカスタマイズ機能**（将来機能）
  - 急落の判定条件をユーザーが設定可能
    - 平均順位の下落幅（デフォルト2位以上 → 1.5位、3位などに変更可能）
    - 特定キーワードの転落条件（デフォルト10位以下 → 5位、15位などに変更可能）
  - 過去何日間の平均順位かをユーザーが設定可能（デフォルト7日間 → 3日、14日、30日などに変更可能）
  - 設定画面で変更可能

**期間**: 1週間（通知の多様化）+ 追加1週間（アラート設定のカスタマイズ）

**注意**: 
- 通知頻度設定は必要だが、優先度は低い（MVPではデフォルト設定で開始）
- アラート設定のカスタマイズは将来機能（MVPでは不要）

### Phase 4: 有料プラン機能

- [ ] プラン管理
- [ ] 使用回数の制限
- [ ] 決済機能（Stripe等）

**期間**: 2週間

### Phase 5: 追加機能（将来）

- [ ] WordPress連携（WordPressユーザーではない人もいるため、後回し）
  - リライト案をワンクリックでWPに反映
  - 料金: +月額1,000円

**期間**: 未定（需要を確認してから実装）

## 技術的な考慮事項

### エラーハンドリング

- API制限に達した場合の対応
- 競合サイトが取得できない場合の対応
- GSCデータが取得できない場合の対応

### パフォーマンス

- 分析の実行時間を30秒以内に
- キャッシュの活用でコスト削減
- 同時実行数の制限

### セキュリティ

- GSCデータの暗号化
- APIキーの安全な管理
- ユーザーデータの保護

