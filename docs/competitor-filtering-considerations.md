# 競合サイトフィルタリング機能の検討観点

## 1. ユーザーの目的・ユースケース分析

### ユーザーが知りたいこと
- **自社サイトを改善するための具体的なアクション**
  - 同じレベルの競合から学ぶべき点
  - 実現可能な改善案
- **市場での自社の位置づけ**
  - 大手サイトとの差を認識
  - 現実的な目標設定

### ユースケース別のニーズ

#### A. ECサイト運営者（Shopify、自社EC等）
- **除外すべき？**: ケースバイケース
  - **除外する場合**: 大手EC（Amazon、楽天）は「競合」ではなく「市場環境」として認識。実現不可能な改善案が生成されるのを防ぐ
  - **含める場合**: 大手ECのコンテンツ戦略や構造を参考にしたい。ただし、改善案は「参考程度」として扱う
- **推奨**: **デフォルトで除外、オプションで含める**

#### B. 情報サイト・ブログ運営者
- **除外すべき？**: 場合による
  - **Wikipedia**: 権威性が高すぎて参考にならない → **除外推奨**
  - **大手メディア**: 参考になる場合もある → **オプション**
- **推奨**: **Wikipediaは除外、その他はオプション**

#### C. サービス提供サイト
- **除外すべき？**: 通常は含める
  - 同業他社のサイトは全て競合として分析すべき
  - 大手企業のサイトも参考になる
- **推奨**: **フィルタリング不要（または最小限）**

## 2. 除外対象サイトの分類

### カテゴリ1: 権威性が高すぎるサイト（常に除外推奨）
- **Wikipedia**
  - 理由: ユーザー生成コンテンツ、権威性が圧倒的、参考にならない
  - 判定: ドメイン `wikipedia.org`
- **政府機関サイト（.go.jp, .gov等）**
  - 理由: 公的機関、参考にならない
  - 判定: ドメインパターン

### カテゴリ2: 大手ECサイト（オプションで除外）
- **Amazon、楽天、Yahoo!ショッピング等**
  - 理由: ブランド力・予算・リソースが圧倒的、実現不可能な改善案が生成される可能性
  - 判定: ドメインリスト
  - **推奨**: デフォルトで除外、設定で含めることができる

### カテゴリ3: 大手メディアサイト（オプションで除外）
- **大手ニュースサイト、大手ポータルサイト等**
  - 理由: 権威性・ブランド力が高い、参考になる場合もある
  - 判定: ドメインリスト
  - **推奨**: デフォルトで含める、設定で除外できる

### カテゴリ4: ソーシャルメディア（常に除外推奨）
- **Twitter、Facebook、Instagram、LinkedIn等**
  - 理由: 検索結果に表示されるが、記事分析の対象外。SNSの投稿は記事コンテンツとは性質が異なる
  - 判定: ドメインパターン（twitter.com, facebook.com, instagram.com, linkedin.com等）

### カテゴリ5: 動画・画像サイト（常に除外推奨）
- **YouTube、Vimeo、Pinterest、Imgur等**
  - 理由: 動画・画像コンテンツはテキスト記事とは性質が異なる。分析対象外
  - 判定: ドメインパターン（youtube.com, vimeo.com, pinterest.com等）

### カテゴリ6: Q&Aサイト・コミュニティサイト（オプションで除外）
- **Yahoo!知恵袋、Quora、Reddit、Stack Overflow等**
  - 理由: ユーザー生成コンテンツ、品質が一定でない。ただし、参考になる場合もある
  - 判定: ドメインパターン
  - **推奨**: デフォルトで含める、設定で除外できる（情報サイト運営者の場合は除外推奨）

### カテゴリ7: レビュー・比較サイト（オプションで除外）
- **価格.com、みんなのレビュー、価格比較サイト等**
  - 理由: レビュー・比較が主目的で、記事コンテンツとは性質が異なる。ただし、ECサイト運営者の場合は参考になる場合もある
  - 判定: ドメインパターン + キーワード判定（「価格」「比較」「レビュー」等）
  - **推奨**: デフォルトで含める、設定で除外できる

### カテゴリ8: アフィリエイトサイト（オプションで除外）
- **明らかにアフィリエイト目的のサイト**
  - 理由: 品質が低い、参考にならない。ただし、判定が難しい
  - 判定: 
    - ドメインパターン（例: `xxx-affiliate.com`）
    - コンテンツ分析（アフィリエイトリンクの多さ、コンテンツの質）
    - **注意**: 自動判定は困難、手動除外が現実的
  - **推奨**: 初期実装では除外しない（将来的に手動除外機能を追加）

### カテゴリ9: 自社サイトのサブドメイン・関連ページ（常に除外推奨）
- **自社サイトの別ページ、サブドメイン**
  - 理由: 自分自身を競合として分析するのは意味がない
  - 判定: 
    - ユーザーが登録したサイトのドメインと一致するURL
    - サブドメインの判定（例: `blog.example.com` と `example.com`）
  - **推奨**: 自動除外（設定不可）

### カテゴリ10: 検索エンジン・ポータルサイト（常に除外推奨）
- **Google、Bing、Yahoo!等**
  - 理由: 検索エンジン自体は分析対象外
  - 判定: ドメインパターン
  - **注意**: Yahoo!は検索エンジンとメディアサイトの両方の側面があるが、検索結果ページは除外

### カテゴリ11: 低品質・スパムサイト（将来的な検討）
- **スパムサイト、低品質サイト**
  - 理由: 参考にならない、分析の質を下げる
  - 判定: 
    - コンテンツの質の自動判定（将来的）
    - ドメインの権威性スコア（将来的）
  - **推奨**: 初期実装では除外しない（将来的に実装）

### カテゴリ12: 業界・カテゴリ別の大手サイト（オプションで除外）
- **業界によって異なる大手サイト**
  - 例: 
    - IT業界: Microsoft、Apple、Google（サービスサイト）
    - 金融業界: 大手銀行、証券会社
    - 不動産業界: 大手不動産サイト
  - 理由: ブランド力・予算が圧倒的、参考にならない場合がある
  - 判定: 
    - ユーザーがカスタム除外リストに追加
    - 業界カテゴリの自動判定（将来的）
  - **推奨**: ユーザーが手動で除外リストに追加できる機能を提供

## 3. 除外判定の技術的な考慮事項

### 判定方法
1. **ドメインベース判定**（推奨）
   - ドメイン名で判定（例: `amazon.co.jp`, `rakuten.co.jp`）
   - サブドメインも含む（例: `www.amazon.co.jp`）
   - **メリット**: シンプル、高速、誤判定が少ない
   - **デメリット**: 新しいサイトを追加する必要がある

2. **URLパターンベース判定**（将来的）
   - URLパターンで判定（例: `*/product/*`, `*/item/*`）
   - **メリット**: 柔軟性が高い
   - **デメリット**: 誤判定の可能性、実装が複雑

3. **コンテンツ分析ベース判定**（将来的）
   - コンテンツの質、構造を分析して判定
   - **メリット**: 自動判定が可能
   - **デメリット**: 実装が複雑、パフォーマンスへの影響

### 除外リストの管理
1. **グローバル除外リスト**（システム全体）
   - Wikipedia、ソーシャルメディア、動画サイト等
   - 全ユーザーに適用、変更不可
2. **デフォルト除外リスト**（ユーザー設定可能）
   - 大手ECサイト、大手メディアサイト等
   - デフォルトで適用、ユーザーが解除可能
3. **ユーザーカスタム除外リスト**（ユーザー固有）
   - ユーザーが独自に追加した除外サイト
   - ユーザーごとに管理

## 4. フィルタリングの実装方針

### オプション1: デフォルト除外リスト（推奨）
- **常に除外（グローバル）**: 
  - Wikipedia
  - ソーシャルメディア（Twitter、Facebook、Instagram等）
  - 動画サイト（YouTube、Vimeo等）
  - 検索エンジン（Google、Bing等）
  - 自社サイトのサブドメイン・関連ページ
- **デフォルトで除外（ユーザー設定可能）**: 
  - 大手ECサイト（Amazon、楽天、Yahoo!ショッピング）
- **設定でカスタマイズ可能**: ユーザーが除外リストを編集できる
- **メリット**: 
  - 実用的な改善案が生成される
  - ユーザーが不要な情報に惑わされない
  - 分析の質が向上
- **デメリット**: 
  - 大手ECの戦略を参考にしたい場合に不便（設定で解除可能）

### オプション2: 完全にユーザー設定
- **デフォルト**: フィルタリングなし
- **ユーザーが設定**: 除外リストを自分で作成
- **メリット**: 
  - 柔軟性が高い
  - ユーザーのニーズに完全対応
- **デメリット**: 
  - 初期設定が面倒
  - デフォルトで不適切な結果が表示される可能性

### オプション3: 分析タイプ別の自動判定（将来的）
- **ECサイト分析**: 自動的に大手ECを除外
- **情報サイト分析**: 自動的にWikipediaを除外
- **サービスサイト分析**: フィルタリング最小限
- **メリット**: ユーザー設定不要で最適化
- **デメリット**: 実装が複雑、判定ロジックの精度が必要

## 4. ユーザー体験への影響

### 分析結果の質への影響
- **除外しない場合**: 
  - 大手サイトのコンテンツが分析対象に含まれる
  - 「Amazonのような商品説明を追加」など実現不可能な改善案が生成される可能性
  - ユーザーが「これは無理だ」と感じて機能の価値を下げる
- **除外する場合**: 
  - より実用的な改善案が生成される
  - ユーザーが「これは実現できそう」と感じる
  - ただし、大手サイトの戦略を参考にしたい場合に不便

### 設定の複雑さ
- **シンプルな設定**: デフォルト除外リストのみ
- **詳細な設定**: カテゴリ別の除外設定、カスタム除外リスト
- **推奨**: まずはシンプルな設定から開始、必要に応じて拡張

## 5. 実装の優先順位

### Phase 1: 最小実装（推奨）
1. **グローバル除外リスト（常に除外、設定不可）**
   - Wikipedia
   - ソーシャルメディア（Twitter、Facebook、Instagram、LinkedIn）
   - 動画サイト（YouTube、Vimeo）
   - 検索エンジン（Google、Bing、Yahoo!検索ページ）
   - 自社サイトのサブドメイン・関連ページ（自動判定）
2. **デフォルト除外リスト（デフォルトで除外、設定で解除可能）**
   - 大手ECサイト（Amazon、楽天、Yahoo!ショッピング）
3. **設定画面での除外リスト編集**
   - ユーザーがカスタム除外リストを追加可能
   - デフォルト除外を解除可能
   - 除外されたサイトの一覧表示（オプション）

### Phase 2: 拡張機能（将来的）
1. **カテゴリ別の除外設定**
   - ECサイト、情報サイト、サービスサイトなど
   - Q&Aサイト、レビューサイト等のカテゴリ別設定
2. **自動判定**
   - サイトタイプを自動判定して最適な除外設定を適用
   - 低品質サイトの自動検出
3. **除外理由の詳細表示**
   - なぜ除外されたかを分析結果に表示
   - 除外されたサイトの一覧と除外理由
4. **地域・言語別の除外リスト**
   - 日本の楽天、アメリカのAmazon等、地域に応じた除外

## 6. 検討すべき質問

### ユーザーへの質問（ユーザーリサーチ推奨）
1. **ECサイト運営者**: Amazonや楽天を競合として分析したいですか？それとも参考程度ですか？
2. **情報サイト運営者**: Wikipediaを競合として分析したいですか？
3. **サービス提供者**: 大手企業のサイトを競合として分析したいですか？

### 技術的な質問
1. **除外判定の精度**: ドメインベースで十分か？URLパターンも必要か？
2. **パフォーマンス**: 除外処理のオーバーヘッドは許容範囲か？
3. **メンテナンス**: 除外リストの更新頻度と方法は？

## 7. 推奨アプローチ

### 初期実装（MVP）
1. **グローバル除外リスト（常に除外、設定不可）**
   - Wikipedia
   - ソーシャルメディア（Twitter、Facebook、Instagram、LinkedIn）
   - 動画サイト（YouTube、Vimeo）
   - 検索エンジン（Google、Bing）
   - 自社サイトのサブドメイン・関連ページ（自動判定）
2. **デフォルト除外リスト（デフォルトで除外、設定で解除可能）**
   - 大手ECサイト（Amazon、楽天、Yahoo!ショッピング）
3. **設定画面**
   - 除外リストの表示
   - 除外の解除/追加（大手ECサイトのみ）
   - カスタム除外リストの追加
   - 説明文: 「大手ECサイトは参考程度として扱うことを推奨します」

### 理由
- **実用的な改善案を生成**: ユーザーが実現可能な改善案を得られる
- **柔軟性**: ユーザーが大手ECを分析したい場合は設定で解除可能
- **シンプル**: 複雑な設定を避け、ユーザー体験を損なわない

## 8. 実装時の注意点

1. **除外理由の表示**: なぜ除外されたかをユーザーに説明
2. **除外リストの透明性**: 除外されたサイトを分析結果に表示（オプション）
3. **パフォーマンス**: 除外処理が分析時間に影響しないように（ドメインベース判定は高速）
4. **多言語・地域対応**: 除外リストは言語・地域によって異なる可能性（例: 日本の楽天、アメリカのAmazon）
5. **自社サイトの判定精度**: サブドメインや関連ページの判定を正確に（誤って自社サイトを除外しない）
6. **除外リストの更新**: 新しいサイトが追加された場合の更新方法を検討
7. **ユーザー教育**: なぜ除外するのか、どのサイトが除外されているかをユーザーに理解してもらう

