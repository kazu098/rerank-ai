# チケット #007: 定期実行（Cron）

## 概要
毎日自動で順位をチェックし、急落時に通知を送信する定期実行機能を実装する。

## 目的
ユーザーの手を煩わせず、自動で順位を監視し、通知を送信する。

## 実装内容

### 1. Vercel Cronの設定
- [ ] `vercel.json`にCron設定を追加
- [ ] 実行頻度の設定（毎日1回）
- [ ] 実行時間の設定（例：毎日午前9時）
- [ ] タイムゾーンの設定

### 2. 定期実行スクリプトの実装
- [ ] API Route（`/api/cron/check-rank`）を作成
- [ ] 全ユーザーのGSC連携情報を取得
- [ ] 各ユーザーの順位データを取得
- [ ] 急落検知ロジックを実行
- [ ] 急落が検知された場合、分析と通知を実行

### 3. 実行フローの統合
- [ ] チケット #001: GSC連携と順位データ取得
- [ ] チケット #002: 順位下落検知ロジック
- [ ] チケット #003: 競合URL取得
- [ ] チケット #004: 競合記事スクレイピング
- [ ] チケット #005: 差分分析とリライト案生成
- [ ] チケット #006: 通知機能

### 4. エラーハンドリング
- [ ] 実行エラーのログ記録
- [ ] エラー通知の実装
- [ ] リトライ機能の実装
- [ ] タイムアウトの処理

### 5. 実行履歴の管理
- [ ] 実行履歴をデータベースに保存
- [ ] 実行結果の記録
- [ ] エラー履歴の記録

## 成果物
- 定期実行スクリプト
- Cron設定
- 実行履歴管理機能

## 技術スタック
- **定期実行**: Vercel Cron（推奨）
- **実行環境**: Vercel
- **データベース**: Supabase（実行履歴の保存）

## 実行頻度
- **デフォルト**: 毎日1回（前日のデータを取得）
- **注意**: GSCデータは1-2日遅れで反映されるため、前日のデータを取得

## テスト項目
- [ ] Cronが正常に実行される
- [ ] 全ユーザーの順位データが正しく取得される
- [ ] 急落検知が正常に動作する
- [ ] 急落時に分析と通知が正常に実行される
- [ ] エラーハンドリングが適切に動作する
- [ ] 実行履歴が正しく記録される

## 見積もり
**期間**: 1日

## 関連ドキュメント
- [最小実装仕様](../docs/minimum-viable-implementation.md)
- [技術スタック](../docs/technical-stack.md)

