# チケット #004: 競合記事スクレイピング

## 概要
競合サイトのHTMLを取得し、テキストを抽出する機能を実装する。

## 目的
競合記事の内容を取得し、分析可能な形式に変換する。

## 実装内容

### 1. cheerioのセットアップ
- [ ] cheerioをインストール
- [ ] HTMLパーサーの設定
- [ ] エラーハンドリングの実装

### 2. HTMLの取得
- [ ] 競合URLからHTMLを取得
- [ ] リクエストのタイムアウト設定
- [ ] リトライ機能の実装
- [ ] ユーザーエージェントの設定

### 3. HTMLパースとテキスト抽出
- [ ] HTMLをパース
- [ ] 不要な要素を除去（広告、ナビゲーション等）
- [ ] 本文テキストを抽出
- [ ] 見出し構造を抽出
- [ ] リスト、テーブル等の構造化データを抽出

### 4. JavaScriptレンダリング対応
- [ ] PlaywrightでJavaScriptレンダリングが必要なサイトを検出
- [ ] 必要に応じてPlaywrightでレンダリング
- [ ] レンダリング後のHTMLを取得
- [ ] テキスト抽出

### 5. データの整形
- [ ] テキストのクリーニング（余分な空白、改行の整理）
- [ ] 文字エンコーディングの処理
- [ ] データの構造化（見出し、段落、リスト等）

### 6. キャッシュ機能
- [ ] スクレイピング結果をデータベースに保存
- [ ] 同じURLの場合はキャッシュから取得
- [ ] キャッシュの有効期限管理

## 成果物
- スクレイピング機能
- テキスト抽出機能
- キャッシュ機能

## 技術スタック
- **スクレイピング**: cheerio（Node.js、推奨）
- **JavaScriptレンダリング**: Playwright
- **データベース**: Supabase（キャッシュ用）

## テスト項目
- [ ] HTMLが正しく取得される
- [ ] テキストが正しく抽出される
- [ ] 見出し構造が正しく抽出される
- [ ] JavaScriptレンダリングが必要なサイトでも正しく動作する
- [ ] キャッシュ機能が正常に動作する

## 見積もり
**期間**: 1-2日

## 関連ドキュメント
- [最小実装仕様](../docs/minimum-viable-implementation.md)
- [技術スタック](../docs/technical-stack.md)

