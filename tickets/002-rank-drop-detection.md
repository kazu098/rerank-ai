# チケット #002: 順位下落検知ロジック

## 概要
GSC APIから取得した順位データを分析し、急落を自動検知する機能を実装する。

## 目的
順位下落を自動検知し、分析対象を特定する。

## 実装内容

### 1. 順位データの比較ロジック
- [ ] 過去7日間の平均順位を計算
- [ ] 現在の平均順位を取得
- [ ] 平均順位の差分を計算
- [ ] 急落の判定（2位以上下落）

### 2. キーワードごとの分析
- [ ] キーワード（クエリ）ごとの順位データを取得
- [ ] 特定キーワードが10位以下に転落した場合を検知
- [ ] 「落選」キーワード（10位前後）を特定
- [ ] 優先度の高いキーワードを選定

### 3. 急落検知ロジック
- [ ] 平均順位の急落判定（2位以上下落）
- [ ] 特定キーワードの転落判定（10位以下）
- [ ] 急落の原因となっているキーワードを特定
- [ ] 分析対象のキーワードを選定

### 4. データ保存
- [ ] 順位データをデータベースに保存（前回比較用）
- [ ] 急落検知の履歴を保存
- [ ] 分析対象のキーワードを保存

## 成果物
- 順位データ取得機能
- 急落検知ロジック（デフォルト設定）
- 分析対象選定機能

## 技術スタック
- **データベース**: Supabase
- **API**: Google Search Console API

## デフォルト設定
- **比較期間**: 過去7日間
- **急落の判定**: 平均順位が2位以上下落、または特定キーワードが10位以下に転落

## テスト項目
- [ ] 過去7日間の平均順位が正しく計算される
- [ ] 急落が正しく検知される（2位以上下落）
- [ ] 特定キーワードの転落が正しく検知される（10位以下）
- [ ] 分析対象のキーワードが正しく選定される

## 見積もり
**期間**: 1日

## 関連ドキュメント
- [最小実装仕様](../docs/minimum-viable-implementation.md)
- [GSC APIデータ構造](../docs/gsc-api-data-structure.md)
- [アラート設定のカスタマイズ](../docs/alert-settings-customization.md)

