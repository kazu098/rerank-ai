# チケット #003: 競合URL取得（ブラウジングツール）

## 概要
下落したキーワードでGoogle検索を実行し、自社URLより上位の競合サイトURLを取得する。

## 目的
下落したキーワードで競合記事を取得するためのURLを特定する。

## 実装内容

### 1. Playwrightのセットアップ
- [ ] Playwrightをインストール
- [ ] ブラウザのセットアップ（Chromium、Firefox、WebKit）
- [ ] ヘッドレスモードの設定
- [ ] ユーザーエージェントの設定

### 2. Google検索の実行
- [ ] 下落したキーワードでGoogle検索を実行
- [ ] 検索結果ページの読み込み待機
- [ ] 検索結果の取得

### 3. 検索結果のパース
- [ ] 検索結果のHTMLをパース
- [ ] 検索結果のURLを抽出
- [ ] 検索結果の順位を特定
- [ ] 自社URLの順位を特定

### 4. 競合URLの抽出
- [ ] 自社URLより上位のサイトURLを抽出（上位3サイト）
- [ ] URLの重複チェック
- [ ] URLの有効性チェック

### 5. CAPTCHA対応
- [ ] CAPTCHAの検出
- [ ] リトライ機能の実装（最大3回）
- [ ] ユーザーエージェントのローテーション
- [ ] リクエスト間隔の調整（5-10秒）

### 6. エラーハンドリング
- [ ] ネットワークエラーの処理
- [ ] タイムアウトの処理
- [ ] CAPTCHA検出時の処理
- [ ] フォールバック機能（Serper APIへの自動切り替え、将来実装）

## 成果物
- ブラウジングツールでの検索機能
- 競合URL抽出機能
- CAPTCHA対応機能

## 技術スタック
- **ブラウジング**: Playwright（推奨）
- **実行環境**: Vercel

## テスト項目
- [ ] Google検索が正常に実行される
- [ ] 検索結果が正しくパースされる
- [ ] 自社URLより上位のサイトURLが正しく抽出される
- [ ] CAPTCHAが検出された場合、リトライが正常に動作する
- [ ] エラーハンドリングが適切に動作する

## 見積もり
**期間**: 2-3日

## 関連ドキュメント
- [最小実装仕様](../docs/minimum-viable-implementation.md)
- [ブラウジングツールの精度分析](../docs/browser-tool-accuracy-analysis.md)
- [Serper APIの必要性](../docs/serper-api-necessity.md)

